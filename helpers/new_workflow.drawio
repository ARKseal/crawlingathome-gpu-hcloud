<mxfile host="app.diagrams.net" modified="2021-09-30T11:44:30.864Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36 Edg/94.0.992.31" etag="mhVKhO-SnnJQt9jGpfAL" version="15.3.8" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="1422" dy="850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-3" value="Central node downloads 100K wat files and extracts candidates&lt;br&gt;&lt;br&gt;we produce huge dataframe about 5-8B lines" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="130" width="190" height="90" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--0" value="dataframe is sorted by domain and wat id, we calculate average links per domain and make chunks of dataframe with no more than this average per domain" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="41.5" y="220" width="189" height="120" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--1" value="chunks are distributed to workers and they download images and prepare jobs for GPU inference&lt;br&gt;&lt;br&gt;link STATUS marked as &quot;downloaded&quot; or &quot;skipped&quot; in the central node dataframe" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="41.5" y="340" width="190" height="130" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--2" value="GPU does inference and mark links as clipped in the central dataframe" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="42.5" y="470" width="189" height="80" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--3" value="when central node sees &amp;gt;80% of links in a wat file as &quot;clipped&quot; or &quot;skipped&quot; then it marks the wat done with the main tracker" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="40" y="550" width="189.5" height="110" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--4" value="URL | TEXT | LICENSE | DOMAIN | HASH | WAT_ID | STATUS | TIMESTAMP" style="rounded=0;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="41.5" y="20" width="760" height="80" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--5" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="390" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--6" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="380" y="140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--7" target="16YRh2MDXtfxeQpDjl7--9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--7" value="download and parse WAT" style="rounded=0;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--9" target="16YRh2MDXtfxeQpDjl7--10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--9" value="&lt;span&gt;combine all parsed csv into a single huge dataframe&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="220" width="140" height="70" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--10" target="16YRh2MDXtfxeQpDjl7--11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--10" value="calculate averages and create chunks with minimum 1000 domains each, spreaded, and max average links per domain" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="300" width="140" height="70" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--11" target="16YRh2MDXtfxeQpDjl7--14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--11" value="workers pick up chunks as jobs" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="660" y="300" width="130" height="70" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--14" target="16YRh2MDXtfxeQpDjl7--15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--14" value="perform download and image processing" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="660" y="380" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--15" target="16YRh2MDXtfxeQpDjl7--16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--15" value="upload results to GPU staging" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="660" y="450" width="130" height="70" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--16" target="16YRh2MDXtfxeQpDjl7--18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--16" value="upload status to central node if chunk is not in the tail" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="660" y="530" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--17" target="16YRh2MDXtfxeQpDjl7--19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--17" value="check on schedule the completion % of wat units" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="600" width="145" height="60" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--18" target="16YRh2MDXtfxeQpDjl7--17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--18" value="update central dataframe with status received from workers" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="530" width="145" height="60" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--19" target="16YRh2MDXtfxeQpDjl7--20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--19" value="mark wat done when more than 80% of the links were completed" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="670" width="145" height="50" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="16YRh2MDXtfxeQpDjl7--20" target="16YRh2MDXtfxeQpDjl7--7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16YRh2MDXtfxeQpDjl7--20" value="when all wat are marked as done, mark not done chunks as tail so workers do not report back anymore, just add jobs to gpu staging while starting a new cycle of 100K wat&amp;nbsp;" style="rounded=1;whiteSpace=wrap;html=1;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="370" y="730" width="145" height="120" as="geometry" />
        </mxCell>
        <mxCell id="QozkiXSPJK8-HQNvlncH-0" value="250-500 workers" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="670" y="270" width="110" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QozkiXSPJK8-HQNvlncH-1" value="cycle status is head" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="515" y="245" width="115" height="20" as="geometry" />
        </mxCell>
        <mxCell id="QozkiXSPJK8-HQNvlncH-2" value="cycle status is tail" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="515" y="780" width="115" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
